// Generated by CoffeeScript 1.10.0
(function(window, $, templates) {
  var button, container, form, formId, iframe, initPlugin, loadMessages, messages, partialSelector, section, setMessage, uploadDone, uploadStart;
  partialSelector = ".svm";
  formId = "#overlay-upload";
  container = $("#dashboard-svm-panel");
  section = container.parents('.o-collapsible-section');
  messages = {
    'uploading': null
  };
  form = null;
  iframe = null;
  button = null;
  setMessage = function(msg) {
    container.find('.messages').remove();
    container.prepend(msg);
    return section.trigger('remax');
  };
  uploadStart = function(e) {
    iframe.on('load', uploadDone);
    button.prop('disabled', true);
    setMessage(messages.uploading);
  };
  uploadDone = function(e) {
    var partial;
    partial = iframe.contents().find(partialSelector);
    container.html(partial);
    section.trigger('remax');
    return initPlugin();
  };
  loadMessages = function() {
    var msgId, results;
    results = [];
    for (msgId in messages) {
      if (messages[msgId] === null) {
        $("#" + msgId).loadTemplate();
        results.push(messages[msgId] = templates[msgId]);
      } else {
        results.push(void 0);
      }
    }
    return results;
  };
  initPlugin = function(e) {
    var action;
    loadMessages();
    iframe = container.find('iframe');
    form = container.find(formId);
    form.on('submit', uploadStart);
    form.prop('target', iframe.prop('name'));
    button = form.find('button');
    action = $('<input>', {
      type: 'hidden',
      name: 'action',
      value: button.attr('value')
    });
    return form.append(action);
  };
  return section.on('dashboard-plugin-loaded', initPlugin);
})(this, this.jQuery, this.templates);
